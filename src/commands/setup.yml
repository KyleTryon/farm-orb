description: >
 Setup F0cal CLI, VPN key, and  ssh keys
parameters:
  api_key:
    description: Your f0cal api key
    type: string
  ssh_key_fingerprint:
    description: The fingerprint of the private key. This needs to first be added to the project in circle
    type: string
steps:
  - run:
      name: Echo parra
      command: echo << parameters.ssh_key_fingerprint >>
  - add_ssh_keys:
      fingerprints:
        - << parameters.ssh_key_fingerprint >>
  - run:
      name: Test SSH KEY
      command: |
        ls ~/.ssh
        cat ~/.ssh/id_rsa
  - run:
      name: connect  to f0cal vpn
      command: |
        source /tmp/env/bin/activate
        f0cal farm configure -k <<parameters.api_key>>
        f0cal farm vpn create >> f0cal_vpn.txt
        sudo openvpn --config f0cal_vpn.txt --daemon
        sleep 20
        ping -c 4 192.168.1.2
        ssh as@192.168.1.20 hostname
